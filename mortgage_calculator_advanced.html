<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage Calculator Advanced</title>
    <link rel="stylesheet" href="stylesheet.css">
    <script>
        function calculateLoan() {
            var loanAmount = parseFloat(document.getElementById("loanAmount").value);
            var interestRate = parseFloat(document.getElementById("interestRate").value);
            var periodYears = parseFloat(document.getElementById("periodYears").value);
            var additionalPayment = parseFloat(document.getElementById("additionalPayment").value);
            var resultEl = document.getElementById("result");

            function showError(msg) {
                resultEl.innerHTML = '<span class="error">' + msg + '</span>';
            }

            // Basic validation
            if (!isFinite(loanAmount) || loanAmount <= 0) {
                showError('Invalid loan amount');
                return;
            }
            if (!isFinite(interestRate) || interestRate < 0) {
                showError('Invalid interest rate');
                return;
            }
            if (!isFinite(periodYears) || periodYears <= 0) {
                showError('Invalid loan period');
                return;
            }
            if (!isFinite(additionalPayment)) {
                // treat empty additional payment as 0
                additionalPayment = 0;
            }

            var monthlyInterestRate = interestRate / 100 / 12;
            var totalMonths = periodYears * 12;
            var monthlyPayment;

            // Handle 0% interest
            if (monthlyInterestRate === 0) {
                monthlyPayment = loanAmount / totalMonths;
            } else {
                monthlyPayment = (loanAmount * monthlyInterestRate) / (1 - Math.pow(1 + monthlyInterestRate, -totalMonths));
            }

            if (!isFinite(monthlyPayment)) {
                showError('Calculation error');
                return;
            }

            var totalPayment = monthlyPayment * totalMonths;
            var totalSavings = (monthlyPayment + additionalPayment) * totalMonths - loanAmount;

            var result = '';
            result += '<strong>Loan Amount:</strong> $' + loanAmount.toFixed(2) + '<br>';
            result += '<strong>Interest Rate:</strong> ' + interestRate.toFixed(2) + '%<br>';
            result += '<strong>Loan Period:</strong> ' + periodYears.toFixed(2) + ' years<br>';
            result += '<strong>Additional Payment:</strong> $' + additionalPayment.toFixed(2) + '<br>';
            result += '<strong>Monthly Payment:</strong> $' + monthlyPayment.toFixed(2) + '<br>';
            result += '<strong>Total Payment:</strong> $' + totalPayment.toFixed(2) + '<br>';
            result += '<strong>Total Savings:</strong> $' + totalSavings.toFixed(2) + '<br>';

            resultEl.innerHTML = result;
        }
    </script>
</head>
<body>
    <h1>Mortgage Calculator Advanced</h1>
    <label for="loanAmount">Loan Amount:</label>
    <input type="number" id="loanAmount"><br>
    <label for="interestRate">Interest Rate (%):</label>
    <input type="number" id="interestRate"><br>
    <label for="periodYears">Loan Period (in years):</label>
    <input type="number" id="periodYears"><br>
    <label for="additionalPayment">Additional Payment (optional):</label>
    <input type="number" id="additionalPayment"><br>
    <button type="button" onclick="calculateLoan()">Calculate</button>
    <div id="result" role="status" aria-live="polite">--</div>
    <button onclick="window.print()">Print</button>
    <p id="lastModified"></p>
    <script src="/scripts/common.js"></script>
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="inputdrive22" data-color="#5F7FFF" data-emoji="ðŸ˜‰"  data-font="Bree" data-text="Buy me a coffee OR tea?" data-outline-color="#000000" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script><br>
    <a href="/index.html">Go to Home page</a><br>
</body>
</html>